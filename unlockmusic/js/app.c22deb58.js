!function(s){function e(e){for(var t,r,n=e[0],i=e[1],a=e[2],c=0,o=[];c<n.length;c++)r=n[c],Object.prototype.hasOwnProperty.call(l,r)&&l[r]&&o.push(l[r][0]),l[r]=0;for(t in i)Object.prototype.hasOwnProperty.call(i,t)&&(s[t]=i[t]);for(d&&d(e);o.length;)o.shift()();return f.push.apply(f,a||[]),u()}function u(){for(var e,t=0;t<f.length;t++){for(var r=f[t],n=!0,i=1;i<r.length;i++){var a=r[i];0!==l[a]&&(n=!1)}n&&(f.splice(t--,1),e=c(c.s=r[0]))}return e}var r={},l={app:0},f=[];function c(e){var t;return(r[e]||(t=r[e]={i:e,l:!1,exports:{}},s[e].call(t.exports,t,t.exports,c),t.l=!0,t)).exports}c.m=s,c.c=r,c.d=function(e,t,r){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},c.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(c.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)c.d(r,n,function(e){return t[e]}.bind(null,n));return r},c.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="";var t=(n=window.webpackJsonp=window.webpackJsonp||[]).push.bind(n);n.push=e;for(var n=n.slice(),i=0;i<n.length;i++)e(n[i]);var d=t;f.push([0,"chunk-vendors"]),u()}({0:function(e,t,r){e.exports=r("cd49")},"0565":function(e,s,u){"use strict";!function(e){var t=u("1da1"),r=(u("96cf"),u("99af"),u("b0c0"),u("7327")),n=u("731b"),i=u("25f1"),a=u("507a"),c=u("73ec"),o=u("b7c7");s.a={name:"FileSelector",data:function(){return{task_all:0,task_finished:0,queue:new c.a,parallel:!1}},computed:{progress_value:function(){return this.task_all?this.task_finished/this.task_all*100:0},progress_show:function(){return this.task_all!==this.task_finished}},mounted:function(){window.Worker&&"file:"!==window.location.protocol?(console.log("Using Worker Pool"),this.queue=Object(r.a)(function(){return Object(n.a)(new i.a(e))},navigator.hardwareConcurrency||1),this.parallel=!0):console.log("Using Queue in Main Thread")},methods:{progress_string:function(){return"".concat(this.task_finished," / ").concat(this.task_all)},addFile:function(n){var i=this;return Object(t.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i.task_all++,i.queue.queue(Object(t.a)(regeneratorRuntime.mark(function e(){var t,r=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0<r.length&&void 0!==r[0]?r[0]:a.a,console.log("start handling",n.name),e.prev=2,e.t0=i,e.t1=t,e.t2=n,e.next=8,o.a.getAll();case 8:return e.t3=e.sent,e.next=11,(0,e.t1)(e.t2,e.t3);case 11:e.t4=e.sent,e.t0.$emit.call(e.t0,"success",e.t4),e.next=19;break;case 15:e.prev=15,e.t5=e.catch(2),console.error(e.t5),i.$emit("error",e.t5,n.name);case 19:return e.prev=19,i.task_finished++,e.finish(19);case 22:case"end":return e.stop()}},e,null,[[2,15,19,22]])})));case 2:case"end":return e.stop()}},e)}))()}}}}.call(this,u("2e83"))},"0ba7":function(e,t,r){"use strict";r.d(t,"a",function(){return n}),r("d3b7"),r("ace4"),r("5cc6"),r("907a"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("170b"),r("b39a"),r("72f7"),r("3ca3"),r("ddb0"),r("2b3d"),r("9861");var l=r("9ab4"),f=r("cc74"),d=r("cb96");function n(c,o,s,u){return void 0===u&&(u=!0),Object(l.a)(this,void 0,Promise,function(){var t,r,n,i,a;return Object(l.c)(this,function(e){switch(e.label){case 0:return t=s,u?(r=Uint8Array.bind,[4,Object(f.c)(c)]):[3,2];case 1:n=new(r.apply(Uint8Array,[void 0,e.sent()])),(t=Object(f.i)(n,s))!==s&&(c=new Blob([n],{type:f.a[t]})),e.label=2;case 2:return[4,Object(d.parseBlob)(c)];case 3:return n=e.sent(),a=Object(f.f)(o,n.common.title,String(n.common.artists||n.common.artist||"")),i=a.title,a=a.artist,[2,{title:i,artist:a,ext:t,album:n.common.album,picture:Object(f.d)(n),file:URL.createObjectURL(c),blob:c,mime:f.a[t]}]}})})}},"0f92":function(e,n,i){"use strict";!function(o){i.d(n,"a",function(){return r}),i("d3b7"),i("a15b"),i("d81d"),i("ac1f"),i("1276"),i("b0c0");var l=i("9ab4"),f=i("cb96"),e=i("acf9"),t=i.n(e),d=i("cc74"),m=i("97e5"),b=function(e){return t.a.decode(new o(e||""),"gbk")};function r(c,o,s,u){return Object(l.a)(this,void 0,Promise,function(){var t,r,n,i,a;return Object(l.c)(this,function(e){switch(e.label){case 0:return[4,Object(f.parseBlob)(c)];case 1:for(r in(t=e.sent()).native)t.native.hasOwnProperty(r)&&t.native[r].some(function(e){return"TCON"===e.id&&"(12)"===e.value})&&(console.warn("try using gbk encoding to decode meta"),t.common.artist="",t.common.artists?t.common.artist=t.common.artists.map(b).join():t.common.artist=b(t.common.artist),t.common.title=b(t.common.title),t.common.album=b(t.common.album));if(u&&"0"!==u)try{return[2,function(a,c,o,s){return Object(l.a)(this,void 0,Promise,function(){var t,r,n,i;return Object(l.c)(this,function(e){switch(e.label){case 0:return[4,Object(m.d)(a)];case 1:return t=e.sent(),r=Object(m.b)(t.track_info.album.pmid),n=t.track_info.singer.map(function(e){return e.name}),i={title:t.track_info.title,artist:n.join(","),album:t.track_info.album.name,imgUrl:r},[4,p({title:t.track_info.title,artists:n,ext:c,imageURL:r,musicMeta:o,blob:s})];case 2:return[2,(i.blob=e.sent(),i)]}})})}(u,s,t,c)]}catch(e){console.warn("在线获取曲目信息失败，回退到本地 meta 提取",e)}return(n=Object(d.f)(o,t.common.title,t.common.artist)).artist=n.artist||"",(i=Object(d.d)(t))?[3,3]:[4,function(r,n,i){return Object(l.a)(this,void 0,Promise,function(){var t;return Object(l.c)(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,Object(m.c)(r,n,i)];case 1:return t=e.sent(),[2,Object(m.b)(t.Id,t.Type)];case 2:return t=e.sent(),console.warn(t),[3,3];case 3:return[2,""]}})})}(n.title,n.artist,t.common.album)];case 2:i=e.sent(),e.label=3;case 3:return a={title:n.title,artist:n.artist,album:t.common.album||"",imgUrl:i},[4,p({title:n.title,artists:n.artist.split(d.m),ext:s,imageURL:i,musicMeta:t,blob:c})];case 4:return[2,(a.blob=e.sent(),a)]}})})}function p(c){return Object(l.a)(this,void 0,Promise,function(){var t,r,n,i,a;return Object(l.c)(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,Object(d.e)(c.imageURL)];case 1:return(t=e.sent())||console.warn("获取图像失败"),t={picture:null==t?void 0:t.buffer,title:c.title,artists:c.artists},n=(r=o).from,[4,c.blob.arrayBuffer()];case 2:return a=n.apply(r,[e.sent()]),i=d.a[c.ext]||d.a.mp3,"mp3"===c.ext?[2,new Blob([Object(d.l)(a,t,c.musicMeta)],{type:i})]:"flac"===c.ext?[2,new Blob([Object(d.k)(a,t,c.musicMeta)],{type:i})]:(console.info("writing metadata for "+c.ext+" is not being supported for now"),[3,4]);case 3:return a=e.sent(),console.warn("Error while appending cover image to file "+a),[3,4];case 4:return[2,c.blob]}})})}}.call(this,i("1c35").Buffer)},1:function(e,t){},1708:function(e,t,r){"use strict";r("8c80")},2:function(e,t){},"2e83":function(e,t,r){e.exports=r.p+"js/0.a6e1f3a4.worker.js"},3:function(e,t){},"321b":function(e,c,o){"use strict";!function(l){var e=o("1da1"),t=(o("96cf"),o("e9c4"),o("d3b7"),o("159b"),o("3ca3"),o("ddb0"),o("2b3d"),o("9861"),o("ac1f"),o("1276"),o("25f0"),o("ab8f")),r=o("af85"),n=o("730d"),i=o("d4ec"),a=o("73ec"),f=o("cc74"),d=o("cb96");c.a={name:"Home",components:{FileSelector:t.a,PreviewTable:r.a,ConfigDialog:n.a,EditDialog:i.a},data:function(){return{showConfigDialog:!1,showEditDialog:!1,editing_data:{picture:"",title:"",artist:"",album:"",albumartist:"",genre:""},tableData:[],playing_url:"",playing_auto:!1,filename_policy:a.e.ArtistAndTitle,instant_save:!1,FilenamePolicies:a.d,dir:null}},watch:{instant_save:function(e){e&&this.showDirectlySave()}},methods:{showSuccess:function(r){var n=this;return Object(e.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.instant_save)return e.next=3,n.saveFile(r);e.next=6;break;case 3:Object(a.f)(r),e.next=8;break;case 6:n.tableData.push(r),n.$notify.success({title:"解锁成功",message:"成功解锁 "+r.title,duration:3e3});case 8:t=[r.title,r.artist,r.album],window._paq.push(["trackEvent","Unlock",r.rawExt+","+r.mime,JSON.stringify(t)]);case 9:case"end":return e.stop()}},e)}))()},showFail:function(e,t){console.error(e,t),this.$notify.error({title:"出现问题",message:e+"，"+t+'，参考<a target="_blank" href="https://github.com/ix64/unlock-music/wiki/使用提示">使用提示</a>',dangerouslyUseHTMLString:!0,duration:6e3}),window._paq.push(["trackEvent","Error",String(e),t])},changePlaying:function(e){this.playing_url=e,this.playing_auto=!0},handleDeleteAll:function(){this.tableData.forEach(function(e){Object(a.f)(e)}),this.tableData=[]},handleDecryptionConfig:function(){this.showConfigDialog=!0},handleDownloadAll:function(){var e=this,t=0,r=setInterval(function(){t<e.tableData.length?(e.saveFile(e.tableData[t]),t++):clearInterval(r)},300)},handleEdit:function(s){var u=this;return Object(e.a)(regeneratorRuntime.mark(function e(){var t,r,n,i,a,c,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u.showEditDialog=!1,URL.revokeObjectURL(u.editing_data.file),s.picture&&(URL.revokeObjectURL(u.editing_data.picture),u.editing_data.picture=URL.createObjectURL(s.picture)),u.editing_data.title=s.title,u.editing_data.artist=s.artist,u.editing_data.album=s.album,t=!0,r="成功修改 "+u.editing_data.title,e.prev=8,e.next=11,Object(d.parseBlob)(new Blob([u.editing_data.blob],{type:o}));case 11:if(n=e.sent,i=void 0,""!==u.editing_data.picture)return e.next=16,Object(f.e)(u.editing_data.picture);e.next=18;break;case 16:(i=e.sent)||console.warn("获取图像失败",u.editing_data.picture);case 18:return a={picture:null==(a=i)?void 0:a.buffer,title:s.title,artists:s.artist.split(f.m),album:s.album,albumartist:s.albumartist,genre:s.genre.split(f.m)},e.t0=l,e.next=22,u.editing_data.blob.arrayBuffer();case 22:e.t1=e.sent,c=e.t0.from.call(e.t0,e.t1),o=f.a[u.editing_data.ext]||f.a.mp3,"mp3"===u.editing_data.ext?u.editing_data.blob=new Blob([Object(f.h)(c,a,n)],{type:o}):"flac"===u.editing_data.ext?u.editing_data.blob=new Blob([Object(f.g)(c,a,n)],{type:o}):(t=void 0,r=u.editing_data.ext+"类型文件暂时不支持修改音乐标签"),e.next=32;break;case 28:e.prev=28,e.t2=e.catch(8),t=!1,r="修改"+u.editing_data.title+"未能完成。在写入新的元数据时发生错误："+e.t2;case 32:u.editing_data.file=URL.createObjectURL(u.editing_data.blob),!0===t?u.$notify.success({title:"修改成功",message:r,duration:3e3}):!1===t?u.$notify.error({title:"修改失败",message:r,duration:3e3}):u.$notify.warning({title:"修改取消",message:r,duration:3e3});case 34:case"end":return e.stop()}},e,null,[[8,28]])}))()},editFile:function(r){var n=this;return Object(e.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.editing_data=r,e.next=3,Object(d.parseBlob)(n.editing_data.blob);case 3:t=e.sent,n.editing_data.albumartist=t.common.albumartist||"",n.editing_data.genre=(null==(t=t.common.genre)?void 0:t.toString())||"",n.showEditDialog=!0;case 7:case"end":return e.stop()}},e)}))()},saveFile:function(t){var r=this;return Object(e.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.dir)return e.next=3,Object(a.b)(t,r.filename_policy,r.dir);e.next=6;break;case 3:r.$notify({title:"保存成功",message:t.title,position:"top-left",type:"success",duration:3e3}),e.next=7;break;case 6:Object(a.c)(t,r.filename_policy);case 7:case"end":return e.stop()}},e)}))()},showDirectlySave:function(){var r=this;return Object(e.a)(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(window.showDirectoryPicker){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,r.$confirm("您的浏览器支持文件直接保存到磁盘，是否使用？","新特性提示",{confirmButtonText:"使用",cancelButtonText:"不使用",type:"warning",center:!0});case 5:e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(2),console.log(e.t0),e.abrupt("return");case 11:return e.prev=11,e.next=14,window.showDirectoryPicker();case 14:return r.dir=e.sent,t="__unlock_music_write_test.txt",e.next=18,r.dir.getFileHandle(t,{create:!0});case 18:return e.next=20,r.dir.removeEntry(t);case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(11),console.error(e.t1);case 25:case"end":return e.stop()}},e,null,[[2,7],[11,22]])}))()}}}}.call(this,o("1c35").Buffer)},4:function(e,t){},5:function(e,t){},"507a":function(n,e,t){"use strict";t.d(e,"a",function(){return r}),t("d3b7"),t("b0c0");var h=t("9ab4"),a=t("9b2d"),c=t("6d95"),v=(t("ace4"),t("5cc6"),t("907a"),t("9a8c"),t("a975"),t("735e"),t("c1ac"),t("d139"),t("3a7b"),t("d5d6"),t("82f8"),t("e91f"),t("60bd"),t("5f96"),t("3280"),t("3fcc"),t("ca91"),t("25a1"),t("cd26"),t("3c5d"),t("2954"),t("649e"),t("219c"),t("170b"),t("b39a"),t("72f7"),t("3ca3"),t("ddb0"),t("2b3d"),t("9861"),t("cc74")),g=t("cb96");t("fb6a");var w=t("0ba7"),y=[105,102,109,116],j=[254,254,254,254],O={" WAV":".wav",FLAC:".flac"," MP3":".mp3"," A4M":".m4a"};t("6c57");var e=t("656c"),m=t.n(e);function b(e){var t=0,r=(e.forEach(function(e){t+=e.length}),new Uint8Array(t)),n=0;return e.forEach(function(e){r.set(e,n),n+=e.length}),r}t("159b");var p=2097152;function x(f,d){return Object(h.a)(this,void 0,Promise,function(){var t,r,n,i,a,c,o,s,u,l;return Object(h.c)(this,function(e){switch(e.label){case 0:t={success:!1,data:new Uint8Array,songId:0,error:""},e.label=1;case 1:return e.trys.push([1,3,,4]),[4,m()()];case 2:return r=e.sent(),[3,4];case 3:return a=e.sent(),t.error=(null==a?void 0:a.message)||"wasm 加载失败",[2,t];case 4:if(r)if(n=new Uint8Array(f),i=r._malloc(p),r.writeArrayToMemory(n.slice(-p),i),d="."+d,-1==(a=r.preDec(i,p,d)))t.error=r.getErr();else{for(t.songId=r.getSongId(),t.songId="0"==t.songId?0:t.songId,c=[],o=0,s=n.length-a;0<s;)u=Math.min(s,p),l=new Uint8Array(n.slice(o,o+u)),r.writeArrayToMemory(l,i),c.push(r.HEAPU8.slice(i,i+r.decBlob(i,u,o))),o+=u,s-=u;r._free(i),t.data=b(c),t.success=!0}else t.error="wasm 加载失败";return[2,t]}})})}var _=t("0f92"),k={mgg:{ext:"ogg",version:2},mgg0:{ext:"ogg",version:2},mggl:{ext:"ogg",version:2},mgg1:{ext:"ogg",version:2},mflac:{ext:"flac",version:2},mflac0:{ext:"flac",version:2},mmp4:{ext:"mp4",version:2},qmcflac:{ext:"flac",version:2},qmcogg:{ext:"ogg",version:2},qmc0:{ext:"mp3",version:2},qmc2:{ext:"ogg",version:2},qmc3:{ext:"mp3",version:2},qmc4:{ext:"ogg",version:2},qmc6:{ext:"ogg",version:2},qmc8:{ext:"ogg",version:2},bkcmp3:{ext:"mp3",version:1},bkcm4a:{ext:"m4a",version:1},bkcflac:{ext:"flac",version:1},bkcwav:{ext:"wav",version:1},bkcape:{ext:"ape",version:1},bkcogg:{ext:"ogg",version:1},bkcwma:{ext:"wma",version:1},tkm:{ext:"m4a",version:1},"666c6163":{ext:"flac",version:1},"6d7033":{ext:"mp3",version:1},"6f6767":{ext:"ogg",version:1},"6d3461":{ext:"m4a",version:1},776176:{ext:"wav",version:1}};function f(m,b,p){return Object(h.a)(this,void 0,Promise,function(){var t,r,n,i,a,c,o,s,u,l,f,d;return Object(h.c)(this,function(e){switch(e.label){case 0:if(p in k)return t=k[p],r=t.version,[4,Object(v.c)(m)];throw"Qmc cannot handle type: ".concat(p);case 1:return a=e.sent(),n=new Uint8Array,2===r&&globalThis.WebAssembly?[4,x(a,p)]:[3,3];case 2:if(!(a=e.sent()).success)throw new Error(a.error||"(unknown error)");n=a.data,i=a.songId,console.log("qmc wasm decoder suceeded"),e.label=3;case 3:return c=Object(v.i)(n,t.ext),o=v.a[c],[4,Object(_.a)(new Blob([n],{type:o}),b,c,i)];case 4:return s=e.sent(),u=s.album,l=s.artist,f=s.imgUrl,d=s.blob,[2,{title:s.title,artist:l,ext:c,album:u,picture:f,file:URL.createObjectURL(d),blob:d,mime:o}]}})})}var e=t("8866"),A=t.n(e),U=2097152;var d=[5,40,188,150,233,228,90,67,145,170,189,208,122,245,54,49],T=[124,213,50,235,134,2,127,75,168,175,166,142,15,255,153,20];function o(u,l,f){return Object(h.a)(this,void 0,Promise,function(){var t,r,n,i,a,c,o,s;return Object(h.c)(this,function(e){switch(e.label){case 0:return[4,Object(v.c)(u)];case 1:if(r=e.sent(),"vpr"===f){if(!Object(v.b)(new Uint8Array(r),d))throw Error("Not a valid vpr file!")}else if(!Object(v.b)(new Uint8Array(r),T))throw Error("Not a valid kgm(a) file!");return t=new Uint8Array,globalThis.WebAssembly?[4,function(f,d){return Object(h.a)(this,void 0,Promise,function(){var t,r,n,i,a,c,o,s,u,l;return Object(h.c)(this,function(e){switch(e.label){case 0:t={success:!1,data:new Uint8Array,error:""},e.label=1;case 1:return e.trys.push([1,3,,4]),[4,A()()];case 2:return r=e.sent(),[3,4];case 3:return a=e.sent(),t.error=(null==a?void 0:a.message)||"wasm 加载失败",[2,t];case 4:if(r){for(n=new Uint8Array(f),i=r._malloc(U),r.writeArrayToMemory(n.slice(0,U),i),a=r.preDec(i,U,d),console.log(a),n=n.slice(a),c=[],o=0,s=n.length;0<s;)u=Math.min(s,U),l=new Uint8Array(n.slice(o,o+u)),r.writeArrayToMemory(l,i),r.decBlob(i,u,o),c.push(r.HEAPU8.slice(i,i+u)),o+=u,s-=u;r._free(i),t.data=b(c),t.success=!0}else t.error="wasm 加载失败";return[2,t]}})})}(r,f)]:[3,3];case 2:if(!(r=e.sent()).success)throw new Error(r.error||"(unknown error)");t=r.data,console.log("kgm wasm decoder suceeded"),e.label=3;case 3:return n=Object(v.i)(t),i=v.a[n],a=new Blob([t],{type:i}),[4,Object(g.parseBlob)(a)];case 4:return c=e.sent(),s=Object(v.f)(l,c.common.title,String(c.common.artists||c.common.artist||"")),o=s.title,s=s.artist,[2,{album:c.common.album,picture:Object(v.d)(c),file:URL.createObjectURL(a),blob:a,ext:n,mime:i,title:o,artist:s}]}})})}t("25f0"),t("843c");var R=[121,101,101,108,105,111,110,45,107,117,119,111,45,116,109,101],P=[121,101,101,108,105,111,110,45,107,117,119,111,0,0,0,0],E="MoOtOiTvINGwd2E6n0E1i7L5t2IoOoNk";function s(m,b){return Object(h.a)(this,void 0,Promise,function(){var t,r,n,i,a,c,o,s,u,l,f,d;return Object(h.c)(this,function(e){switch(e.label){case 0:return r=Uint8Array.bind,[4,Object(v.c)(m)];case 1:return t=new(r.apply(Uint8Array,[void 0,e.sent()])),Object(v.b)(t,R)||Object(v.b)(t,P)?[3,4]:"aac"!==Object(v.i)(t)?[3,3]:[4,Object(w.a)(m,b,"aac",!1)];case 2:return[2,e.sent()];case 3:throw Error("not a valid kwm file");case 4:for(o=t.slice(24,32),n=function(e){for(var t=function(e){var t=e.length,r=e;return 32<t?r=e.slice(0,32):t<32&&(r=e.padEnd(32,e)),r}(new DataView(e.buffer).getBigUint64(0,!0).toString()),r=new Uint8Array(32),n=0;n<32;n++)r[n]=E.charCodeAt(n)^t.charCodeAt(n);return r}(o),i=t.slice(1024),a=i.length,c=0;c<a;++c)i[c]^=n[c%32];return o=Object(v.i)(i),s=v.a[o],u=new Blob([i],{type:s}),[4,Object(g.parseBlob)(u)];case 5:return l=e.sent(),d=Object(v.f)(b,l.common.title,String(l.common.artists||l.common.artist||"")),f=d.title,d=d.artist,[2,{album:l.common.album,picture:Object(v.d)(l),file:URL.createObjectURL(u),blob:u,mime:s,title:f,artist:d,ext:o}]}})})}var u=[0,0,0,32,102,116,121,112];t("ac1f"),t("466d");var e=t("dc71"),D=t.n(e),L=t("b7c7");t("4ec9");var l=new Map([["x2m",function(e){for(var t=[120,109,108,121],r=e.slice(0,1024),n=0;n<1024;n++){var i=S[n];e[n]=r[i]^t[n%t.length]}return e}],["x3m",function(e){for(var t=[51,57,56,57,100,49,49,49,97,97,100,53,54,49,51,57,52,48,102,52,102,99,52,52,98,54,51,57,98,50,57,50],r=e.slice(0,1024),n=0;n<1024;n++){var i=F[n];e[n]=r[i]^t[n%t.length]}return e}]]);var S=[681,683,340,682,680,684,339,679,685,338,678,1023,0,341,686,337,677,1022,1,342,687,336,676,1021,2,343,688,335,675,1020,3,344,689,334,674,1019,4,345,690,333,673,1018,5,346,691,332,672,1017,6,347,692,331,671,1016,7,348,693,330,670,1015,8,349,694,329,669,1014,9,350,695,328,668,1013,10,351,696,327,667,1012,11,352,697,326,666,1011,12,353,698,325,665,1010,13,354,699,324,664,1009,14,355,700,323,663,1008,15,356,701,322,662,1007,16,357,702,321,661,1006,17,358,703,320,660,1005,18,359,704,319,659,1004,19,360,705,318,658,1003,20,361,706,317,657,1002,21,362,707,316,656,1001,22,363,708,315,655,1e3,23,364,709,314,654,999,24,365,710,313,653,998,25,366,711,312,652,997,26,367,712,311,651,996,27,368,713,310,650,995,28,369,714,309,649,994,29,370,715,308,648,993,30,371,716,307,647,992,31,372,717,169,510,855,32,373,718,170,511,856,33,374,719,171,512,857,34,375,720,172,513,858,35,376,721,173,514,859,36,377,722,174,515,860,37,378,723,175,516,861,38,379,724,176,517,862,39,380,725,177,518,863,40,381,726,178,519,864,41,382,727,179,520,865,42,383,728,180,521,866,43,384,729,181,522,867,44,385,730,182,523,868,45,386,731,183,524,869,46,387,732,184,525,870,47,388,733,185,526,871,48,389,734,186,527,872,49,390,735,187,528,873,50,391,736,188,529,874,51,392,737,189,530,875,52,393,738,190,531,876,53,394,739,191,532,877,54,395,740,192,533,878,55,396,741,193,534,879,56,397,742,194,535,880,57,398,743,195,536,881,58,399,744,196,537,882,59,400,745,197,538,883,60,401,746,198,539,884,61,402,747,199,540,885,62,403,748,200,541,886,63,404,749,201,542,887,64,405,750,202,543,888,65,406,751,203,544,889,66,407,752,204,545,890,67,408,753,205,546,891,68,409,754,206,547,892,69,410,755,207,548,893,70,411,756,208,549,894,71,412,757,209,550,895,72,413,758,210,551,896,73,414,759,211,552,897,74,415,760,212,553,898,75,416,761,213,554,899,76,417,762,214,555,900,77,418,763,215,556,901,78,419,764,216,557,902,79,420,765,217,558,903,80,421,766,218,559,904,81,422,767,219,560,905,82,423,768,220,561,906,83,424,769,221,562,907,84,425,770,222,563,908,85,426,771,223,564,909,86,427,772,224,565,910,87,428,773,225,566,911,88,429,774,226,567,912,89,430,775,227,568,913,90,431,776,228,569,914,91,432,777,229,570,915,92,433,778,230,571,916,93,434,779,231,572,917,94,435,780,232,573,918,95,436,781,233,574,919,96,437,782,234,575,920,97,438,783,235,576,921,98,439,784,236,577,922,99,440,785,237,578,923,100,441,786,238,579,924,101,442,787,239,580,925,102,443,788,240,581,926,103,444,789,241,582,927,104,445,790,242,583,928,105,446,791,243,584,929,106,447,792,244,585,930,107,448,793,245,586,931,108,449,794,246,587,932,109,450,795,247,588,933,110,451,796,248,589,934,111,452,797,249,590,935,112,453,798,250,591,936,113,454,799,251,592,937,114,455,800,252,593,938,115,456,801,253,594,939,116,457,802,254,595,940,117,458,803,255,596,941,118,459,804,256,597,942,119,460,805,257,598,943,120,461,806,258,599,944,121,462,807,259,600,945,122,463,808,260,601,946,123,464,809,261,602,947,124,465,810,262,603,948,125,466,811,263,604,949,126,467,812,264,605,950,127,468,813,265,606,951,128,469,814,266,607,952,129,470,815,267,608,953,130,471,816,268,609,954,131,472,817,269,610,955,132,473,818,270,611,956,133,474,819,271,612,957,134,475,820,272,613,958,135,476,821,273,614,959,136,477,822,274,615,960,137,478,823,275,616,961,138,479,824,276,617,962,139,480,825,277,618,963,140,481,826,278,619,964,141,482,827,279,620,965,142,483,828,280,621,966,143,484,829,281,622,967,144,485,830,282,623,968,145,486,831,283,624,969,146,487,832,284,625,970,147,488,833,285,626,971,148,489,834,286,627,972,149,490,835,287,628,973,150,491,836,288,629,974,151,492,837,289,630,975,152,493,838,290,631,976,153,494,839,291,632,977,154,495,840,292,633,978,155,496,841,293,634,979,156,497,842,294,635,980,157,498,843,295,636,981,158,499,844,296,637,982,159,500,845,297,638,983,160,501,846,298,639,984,161,502,847,299,640,985,162,503,848,300,641,986,163,504,849,301,642,987,164,505,850,302,643,988,165,506,851,303,644,989,166,507,852,304,645,990,167,508,853,305,646,991,168,509,854,306],F=[598,653,531,775,342,925,98,368,970,53,237,676,484,857,211,619,613,628,593,663,514,802,294,811,279,770,348,936,87,328,896,144,502,821,268,750,373,980,43,204,608,635,573,699,438,929,94,343,926,97,367,966,57,247,697,440,927,96,358,953,70,290,796,303,829,252,714,420,972,51,230,659,521,789,317,856,213,622,606,637,570,704,433,943,80,310,838,239,682,462,886,160,528,780,332,905,130,475,871,185,574,698,439,928,95,356,951,72,293,806,284,778,335,911,112,424,967,56,245,693,445,915,108,409,993,30,179,559,727,403,1002,21,157,522,788,318,858,210,618,615,626,595,660,520,793,311,844,231,661,517,797,302,828,254,717,416,981,42,200,600,646,554,732,398,1015,8,124,467,880,167,541,753,369,973,50,229,658,523,787,319,860,208,614,627,594,662,516,799,298,818,271,756,364,963,60,257,722,410,992,31,181,563,713,422,969,54,240,683,459,892,149,509,808,282,774,344,930,93,341,924,99,372,979,44,207,612,629,591,665,506,812,277,767,351,939,84,323,876,173,549,741,385,1007,16,140,497,836,243,687,452,902,136,483,859,209,617,616,621,607,636,571,703,434,942,81,315,853,218,632,584,678,476,869,192,582,680,470,877,172,548,744,382,1003,20,156,519,794,307,833,248,700,437,931,92,338,917,106,396,1017,6,122,465,883,164,535,766,352,941,82,316,855,215,624,604,641,565,710,426,956,67,285,781,330,900,138,487,851,221,644,558,728,402,1004,19,153,513,803,292,801,295,813,276,765,353,944,79,309,835,244,692,446,914,109,413,987,36,190,580,688,450,906,128,473,873,182,564,712,423,968,55,241,685,454,899,141,498,827,256,721,411,990,33,187,576,694,443,921,102,378,991,32,184,572,701,436,933,90,336,912,111,421,971,52,234,669,494,840,236,675,485,854,216,625,599,649,544,748,376,985,38,194,587,673,490,845,228,657,524,786,321,864,202,602,643,560,720,412,989,34,188,577,691,447,913,110,418,977,46,214,623,605,639,567,708,428,954,69,289,792,312,846,227,655,529,779,333,908,115,451,903,132,479,866,199,597,654,530,777,339,918,105,395,1018,5,121,464,884,162,533,769,349,937,86,327,890,152,512,804,287,790,314,850,223,648,547,745,381,1001,22,158,525,784,324,882,165,537,762,357,952,71,291,798,301,824,263,736,392,1022,1,117,457,894,147,505,815,274,761,359,958,65,267,743,383,1005,18,151,511,805,286,785,322,870,186,575,696,441,923,100,374,982,41,197,592,664,508,809,281,772,346,934,89,334,910,113,429,950,73,296,814,275,764,354,946,77,305,831,250,706,431,947,76,304,830,251,711,425,957,66,278,768,350,938,85,326,888,155,518,795,306,832,249,702,435,940,83,320,861,206,610,633,583,679,471,875,174,550,739,389,1014,9,125,468,879,168,542,752,370,974,49,222,647,552,735,393,1021,2,118,458,893,148,507,810,280,771,347,935,88,331,904,131,477,868,193,586,674,489,848,225,651,538,760,360,959,64,266,742,384,1006,17,145,503,820,269,751,371,975,48,220,640,566,709,427,955,68,288,791,313,847,226,652,536,763,355,948,75,300,823,264,738,390,1020,3,119,460,891,150,510,807,283,776,340,919,104,387,1011,12,133,480,865,201,601,645,556,730,400,1010,13,134,481,863,203,603,642,562,716,417,978,45,212,620,611,631,585,677,478,867,198,596,656,526,783,325,887,159,527,782,329,898,142,499,826,258,723,408,994,29,178,557,729,401,1009,14,135,482,862,205,609,634,579,689,449,907,127,472,874,180,561,719,414,986,37,191,581,684,455,897,143,501,822,265,740,388,1012,11,129,474,872,183,569,705,432,945,78,308,834,246,695,442,922,101,377,988,35,189,578,690,448,909,114,444,920,103,386,1008,15,139,488,849,224,650,540,755,365,964,59,255,718,415,983,40,196,590,667,496,837,242,686,453,901,137,486,852,219,638,568,707,430,949,74,299,819,270,754,366,965,58,253,715,419,976,47,217,630,588,671,492,842,233,668,495,839,238,681,463,885,161,532,773,345,932,91,337,916,107,406,998,25,171,546,746,380,997,26,175,551,737,391,1023,0,116,456,895,146,504,817,272,758,362,961,62,260,725,405,999,24,170,545,747,379,996,27,176,553,733,397,1016,7,123,466,881,166,539,757,363,962,61,259,724,407,995,28,177,555,731,399,1013,10,126,469,878,169,543,749,375,984,39,195,589,670,493,841,235,672,491,843,232,666,500,825,262,734,394,1019,4,120,461,889,154,515,800,297,816,273,759,361,960,63,261,726,404,1e3,23,163,534],B=t("efc0");function r(n,i){return Object(h.a)(this,void 0,Promise,function(){var t,r;return Object(h.c)(this,function(e){switch(e.label){case 0:return L.a instanceof B.a?[4,L.a.setAll(i)]:[3,2];case 1:e.sent(),e.label=2;case 2:switch(t=Object(v.j)(n.name),t.ext){case"mg3d":return[3,3];case"ncm":return[3,5];case"uc":return[3,7];case"kwm":return[3,9];case"xm":case"wav":case"mp3":case"flac":case"m4a":return[3,11];case"ogg":return[3,13];case"tm0":case"tm3":return[3,15];case"qmc0":case"qmc3":case"qmc2":case"qmc4":case"qmc6":case"qmc8":case"qmcflac":case"qmcogg":case"tkm":case"bkcmp3":case"bkcm4a":case"bkcflac":case"bkcwav":case"bkcape":case"bkcogg":case"bkcwma":case"mggl":case"mflac":case"mflac0":case"mflach":case"mgg":case"mgg1":case"mgg0":case"mmp4":case"666c6163":case"6d7033":case"6f6767":case"6d3461":case"776176":return[3,17];case"tm2":case"tm6":return[3,19];case"cache":return[3,21];case"vpr":case"kgm":case"kgma":return[3,23];case"ofl_en":return[3,25];case"x2m":case"x3m":return[3,27];case"mflach":return[3,29]}return[3,30];case 3:return[4,Object(a.a)(n.raw,t.name)];case 4:return r=e.sent(),[3,31];case 5:return[4,Object(c.a)(n.raw,t.name,t.ext)];case 6:return r=e.sent(),[3,31];case 7:return[4,function(u,l,f){return Object(h.a)(this,void 0,Promise,function(){var t,r,n,i,a,c,o,s;return Object(h.c)(this,function(e){switch(e.label){case 0:return r=Uint8Array.bind,[4,Object(v.c)(u)];case 1:for(t=new(r.apply(Uint8Array,[void 0,e.sent()])),n=t.length,i=0;i<n;i++)t[i]^=163;return(a=Object(v.i)(t,f))!==f&&(u=new Blob([t],{type:v.a[a]})),[4,Object(g.parseBlob)(u)];case 2:return c=e.sent(),s=Object(v.f)(l,c.common.title,String(c.common.artists||c.common.artist||"")),o=s.title,s=s.artist,[2,{title:o,artist:s,ext:a,album:c.common.album,picture:Object(v.d)(c),file:URL.createObjectURL(u),blob:u,mime:v.a[a]}]}})})}(n.raw,t.name,t.ext)];case 8:return r=e.sent(),[3,31];case 9:return[4,s(n.raw,t.name,t.ext)];case 10:return r=e.sent(),[3,31];case 11:return[4,function(m,b,p){return Object(h.a)(this,void 0,Promise,function(){var t,r,n,i,a,c,o,s,u,l,f,d;return Object(h.c)(this,function(e){switch(e.label){case 0:return r=Uint8Array.bind,[4,Object(v.c)(m)];case 1:if(t=new(r.apply(Uint8Array,[void 0,e.sent()])),Object(v.b)(t,y)&&Object(v.b)(t.slice(8,12),j))return[3,4];if("xm"!==p)return[3,2];throw Error("此xm文件已损坏");case 2:return[4,Object(w.a)(m,b,p,!0)];case 3:return[2,e.sent()];case 4:if(s=(new TextDecoder).decode(t.slice(4,8)),!O.hasOwnProperty(s))throw Error("未知的.xm文件类型");for(n=t[15],o=t[12]|t[13]<<8|t[14]<<16,i=t.slice(16),a=i.length,c=o;c<a;++c)i[c]=i[c]-n^255;return o=O[s],s=v.a[o],u=new Blob([i],{type:s}),[4,Object(g.parseBlob)(u)];case 5:return l=e.sent(),"wav"===o&&(console.info(l.common),l.common.album="",l.common.artist="",l.common.title=""),d=Object(v.f)(b,l.common.title,String(l.common.artists||l.common.artist||""),-1===b.indexOf("_")?"-":"_"),f=d.title,d=d.artist,[2,{title:f,artist:d,ext:o,mime:s,album:l.common.album,picture:Object(v.d)(l),file:URL.createObjectURL(u),blob:u,rawExt:"xm"}]}})})}(n.raw,t.name,t.ext)];case 12:return r=e.sent(),[3,31];case 13:return[4,Object(w.a)(n.raw,t.name,t.ext)];case 14:return r=e.sent(),[3,31];case 15:return[4,Object(w.a)(n.raw,t.name,"mp3")];case 16:return r=e.sent(),[3,31];case 17:return[4,f(n.raw,t.name,t.ext)];case 18:return r=e.sent(),[3,31];case 19:return[4,function(a,c){return Object(h.a)(this,void 0,Promise,function(){var t,r,n,i;return Object(h.c)(this,function(e){switch(e.label){case 0:return r=Uint8Array.bind,[4,Object(v.c)(a)];case 1:for(t=new(r.apply(Uint8Array,[void 0,e.sent()])),n=0;n<8;++n)t[n]=u[n];return i=new Blob([t],{type:"audio/mp4"}),[4,Object(w.a)(i,c,"m4a",!1)];case 2:return[2,e.sent()]}})})}(n.raw,t.name)];case 20:return r=e.sent(),[3,31];case 21:return[4,function(s,u,l){return Object(h.a)(this,void 0,Promise,function(){var t,r,n,i,a,c,o;return Object(h.c)(this,function(e){switch(e.label){case 0:return[4,Object(v.c)(s)];case 1:return r=e.sent(),t=new Uint8Array,globalThis.WebAssembly?(console.log("qmc: using wasm decoder"),[4,x(r,l)]):[3,3];case 2:if(!(r=e.sent()).success)throw new Error(r.error||"(unknown error)");t=r.data,console.log("qmc wasm decoder suceeded"),e.label=3;case 3:if(n=Object(v.i)(t,""),a=Object(v.j)(u),""!==n||"mp3"===a.ext)return i=new Blob([t],{type:v.a[n]}),[4,Object(g.parseBlob)(i)];if(a.ext in k)return[2,f(i=new Blob([t],{type:"application/octet-stream"}),a.name,a.ext)];throw"不支持的QQ音乐缓存格式";case 4:return a=e.sent(),o=Object(v.f)(u,a.common.title,String(a.common.artists||a.common.artist||"")),c=o.title,o=o.artist,[2,{title:c,artist:o,ext:n,album:a.common.album,picture:Object(v.d)(a),file:URL.createObjectURL(i),blob:i,mime:v.a[n]}]}})})}(n.raw,t.name,t.ext)];case 22:return r=e.sent(),[3,31];case 23:return[4,o(n.raw,t.name,t.ext)];case 24:return r=e.sent(),[3,31];case 25:return[4,function(l,f){var d;return Object(h.a)(this,void 0,Promise,function(){var t,r,n,i,a,c,o,s,u;return Object(h.c)(this,function(e){switch(e.label){case 0:return[4,L.a.loadJooxUUID("")];case 1:if((t=e.sent())&&32===t.length)return r=Uint8Array.bind,[4,Object(v.c)(l)];throw new Error("请在“解密设定”填写应用 Joox 应用的 UUID。");case 2:if(c=new(r.apply(Uint8Array,[void 0,e.sent()])),a=D()(c,t))return a=b(a.decryptFile(c)),n=Object(v.i)(a),i=v.a[n],c=null==(d=f.match(/^(\d+)\s\[mqms\d*]$/i))?void 0:d[1],[4,Object(_.a)(new Blob([a],{type:i}),f,n,c)];throw new Error("不支持的 joox 加密格式");case 3:return a=e.sent(),c=a.album,o=a.artist,s=a.imgUrl,u=a.blob,[2,{title:a.title,artist:o,ext:n,album:c,picture:s,file:URL.createObjectURL(u),blob:u,mime:i}]}})})}(n.raw,t.name,t.ext)];case 26:return r=e.sent(),[3,31];case 27:return[4,function(o,s,u){return Object(h.a)(this,void 0,Promise,function(){var t,r,n,i,a,c;return Object(h.c)(this,function(e){switch(e.label){case 0:return t=Uint8Array.bind,[4,Object(v.c)(o)];case 1:if(a=new(t.apply(Uint8Array,[void 0,e.sent()])),c=l.get(u))return c=c(a),r=Object(v.i)(c,"m4a"),n=v.a[r],i=new Blob([c],{type:n}),[4,Object(g.parseBlob)(i)];throw"File type is incorrect!";case 2:return a=e.sent(),[2,{picture:"",title:(c=Object(v.f)(s,a.common.title,a.common.artist)).title,artist:c.artist,ext:r,album:a.common.album,blob:i,file:URL.createObjectURL(i),mime:n}]}})})}(n.raw,t.name,t.ext)];case 28:return r=e.sent(),[3,31];case 29:throw'网页版无法解锁，请使用<a target="_blank" href="https://git.unlock-music.dev/um/cli">CLI版本</a>';case 30:throw"不支持此文件格式";case 31:return r.rawExt||(r.rawExt=t.ext),r.rawFilename||(r.rawFilename=t.name),console.log(r),[2,r]}})})}},"5c0b":function(e,t,r){"use strict";r("9c0c")},6:function(e,t){},"675e":function(e,t,r){"use strict";r.d(t,"a",function(){return n});var n="um.conf.",i="".concat(n,"joox.uuid");function a(){}a.prototype.saveJooxUUID=function(e){return this.save(i,e)},a.prototype.loadJooxUUID=function(e){return this.load(i,e=void 0===e?"":e)},t.b=a},"6d95":function(e,g,w){"use strict";!function(s){w.d(g,"a",function(){return t}),w("d3b7"),w("ace4"),w("5cc6"),w("907a"),w("9a8c"),w("a975"),w("735e"),w("c1ac"),w("d139"),w("3a7b"),w("d5d6"),w("82f8"),w("e91f"),w("60bd"),w("5f96"),w("3280"),w("3fcc"),w("ca91"),w("25a1"),w("cd26"),w("3c5d"),w("2954"),w("649e"),w("219c"),w("170b"),w("b39a"),w("72f7"),w("d81d"),w("fb6a"),w("ddb0"),w("25f0"),w("ac1f"),w("5319"),w("159b"),w("4de4"),w("1276"),w("498a"),w("a15b"),w("3ca3"),w("2b3d"),w("9861");var u=w("9ab4"),l=w("cc74"),r=w("cb96"),e=w("ef21"),f=w.n(e),e=w("c198"),c=w.n(e),e=w("ead9"),o=w.n(e),e=w("81bf"),d=w.n(e),e=w("17e1"),m=w.n(e),e=w("1132"),n=w.n(e),e=w("f8d5"),i=w.n(e),e=w("640f"),e=w.n(e),b=e.a.parse("687a4852416d736f356b496e62617857"),a=e.a.parse("2331346C6A6B5F215C5D2630553C2728"),p=[67,84,69,78,70,68,65,77];function t(r,n,e){return Object(u.a)(this,void 0,Promise,function(){var t;return Object(u.c)(this,function(e){switch(e.label){case 0:return t=h.bind,[4,Object(l.c)(r)];case 1:return[2,(new(t.apply(h,[void 0,e.sent(),n]))).decrypt()]}})})}v.prototype._getKeyData=function(){var e=this.view.getUint32(this.offset,!0),t=(this.offset+=4,new Uint8Array(this.raw,this.offset,e).map(function(e){return 100^e}));this.offset+=e;for(var e=c.a.decrypt({ciphertext:m.a.create(t)},b,{mode:d.a,padding:o.a}),r=new Uint8Array(e.sigBytes),n=e.words,i=e.sigBytes,a=0;a<i;a++)r[a]=n[a>>>2]>>>24-a%4*8&255;return r.slice(17)},v.prototype._getKeyBox=function(){for(var e,t=this._getKeyData(),r=new Uint8Array(Array(256).keys()),n=t.length,i=0,a=0;a<256;a++)e=[r[i=r[a]+i+t[a%n]&255],r[a]],r[a]=e[0],r[i]=e[1];return r.map(function(e,t,r){var n=r[t=t+1&255];return r[n+r[t+n&255]&255]})},v.prototype._getMetaData=function(){var e=this.view.getUint32(this.offset,!0);if(this.offset+=4,0===e)return{};var t=new Uint8Array(this.raw,this.offset,e).map(function(e){return 99^e});this.offset+=e,m.a.create();var e=c.a.decrypt({ciphertext:n.a.parse(m.a.create(t.slice(22)).toString(i.a))},a,{mode:d.a,padding:o.a}).toString(i.a),t=e.indexOf(":");return(e="dj"===e.slice(0,t)?JSON.parse(e.slice(t+1)).mainMusic:JSON.parse(e.slice(t+1))).albumPic&&(e.albumPic=e.albumPic.replace("http://","https://")+"?param=500y500"),e},v.prototype._getAudio=function(e){this.offset+=this.view.getUint32(this.offset+5,!0)+13;for(var t=new Uint8Array(this.raw,this.offset),r=t.length,n=0;n<r;++n)t[n]^=e[255&n];return t},v.prototype._buildMeta=function(){var o;return Object(u.a)(this,void 0,void 0,function(){var t,r,n,i,a,c;return Object(u.c)(this,function(e){switch(e.label){case 0:if(!this.oriMeta)throw Error("invalid sequence");if(t=Object(l.f)(this.filename,this.oriMeta.musicName),r=[],"string"==typeof this.oriMeta.artist?r.push(this.oriMeta.artist):Array.isArray(this.oriMeta.artist)&&this.oriMeta.artist.forEach(function(e){"string"==typeof e?r.push(e):Array.isArray(e)&&e[0]&&"string"==typeof e[0]&&r.push(e[0])}),0===r.length&&t.artist&&(r=t.artist.split(",").map(function(e){return e.trim()}).filter(function(e){return""!=e})),!this.oriMeta.albumPic)return[3,9];e.label=1;case 1:return e.trys.push([1,8,,9]),n=this,[4,Object(l.e)(this.oriMeta.albumPic)];case 2:n.image=e.sent(),e.label=3;case 3:return this.image&&this.image.buffer.byteLength>=1<<24?[4,f.a.read(s.from(this.image.buffer))]:[3,7];case 4:return[4,(i=e.sent()).resize(Math.round(i.getHeight()/2),f.a.AUTO)];case 5:return e.sent(),a=this.image,[4,i.getBufferAsync("image/jpeg")];case 6:return a.buffer=e.sent(),[3,3];case 7:return[3,9];case 8:return c=e.sent(),console.log("fetch cover image failed",c),[3,9];case 9:return this.newMeta={title:t.title,artists:r,album:this.oriMeta.album,picture:null==(o=this.image)?void 0:o.buffer},[2]}})})},v.prototype._writeMeta=function(){return Object(u.a)(this,void 0,void 0,function(){var t;return Object(u.c)(this,function(e){switch(e.label){case 0:if(this.audio&&this.newMeta)return this.blob||(this.blob=new Blob([this.audio],{type:this.mime})),[4,Object(r.parseBlob)(this.blob)];throw Error("invalid sequence");case 1:if(t=e.sent(),!t.common.album&&!t.common.artists&&!t.common.title||this.newMeta.picture){if("mp3"===this.format)this.audio=Object(l.l)(s.from(this.audio),this.newMeta,t);else{if("flac"!==this.format)return console.info("writing meta for ".concat(this.format," is not being supported for now")),[2];this.audio=Object(l.k)(s.from(this.audio),this.newMeta,t)}this.blob=new Blob([this.audio],{type:this.mime})}return[2]}})})},v.prototype.gatherResult=function(){var e;if(this.newMeta&&this.blob)return{title:this.newMeta.title,artist:null==(e=this.newMeta.artists)?void 0:e.join("; "),ext:this.format,album:this.newMeta.album,picture:null==(e=this.image)?void 0:e.url,file:URL.createObjectURL(this.blob),blob:this.blob,mime:this.mime};throw Error("bad sequence")},v.prototype.decrypt=function(){return Object(u.a)(this,void 0,void 0,function(){var t;return Object(u.c)(this,function(e){switch(e.label){case 0:t=this._getKeyBox(),this.oriMeta=this._getMetaData(),this.audio=this._getAudio(t),this.format=this.oriMeta.format||Object(l.i)(this.audio),this.mime=l.a[this.format],e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this._buildMeta()];case 2:return e.sent(),[4,this._writeMeta()];case 3:return e.sent(),[3,5];case 4:return t=e.sent(),console.warn("build/write meta failed, skip.",t),[3,5];case 5:return[2,this.gatherResult()]}})})};var h=v;function v(e,t){this.offset=0,this.format="",this.mime="";var r=new Uint8Array(e,0,8);if(!Object(l.b)(r,p))throw Error("此ncm文件已损坏");this.offset=10,this.raw=e,this.view=new DataView(e),this.filename=t}}.call(this,w("1c35").Buffer)},"730d":function(e,t,r){"use strict";var n=r("1da1"),i=(r("96cf"),r("ac1f"),r("00b4"),r("b7c7")),a=r("77b3");var c={jooxUUID:{validator:function(e,t,r){t&&/^[\da-fA-F]{32}$/.test(t)?r():r(new Error("无效的 Joox UUID，请参考 Wiki 获取。"))},trigger:"change"}},a={components:{Ruby:a.a},props:{show:{type:Boolean,required:!0}},data:function(){return{rules:c,saving:!1,form:{jooxUUID:""},centerDialogVisible:!1}},mounted:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.resetForm();case 2:case"end":return e.stop()}},e)}))()},methods:{resetForm:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.loadJooxUUID();case 2:t.form.jooxUUID=e.sent;case 3:case"end":return e.stop()}},e)}))()},cancel:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.resetForm();case 2:t.$emit("done");case 3:case"end":return e.stop()}},e)}))()},emitConfirm:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.saving=!0,e.next=3,i.a.saveJooxUUID(t.form.jooxUUID);case 3:t.saving=!1,t.$emit("done");case 5:case"end":return e.stop()}},e)}))()}}},r=(r("b0a8"),r("2877")),r=Object(r.a)(a,function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("el-dialog",{attrs:{title:"解密设定",visible:t.show,"custom-class":"um-config-dialog",center:""},on:{close:function(e){return t.cancel()}}},[e("el-form",{ref:"form",attrs:{rules:t.rules,"status-icon":"",model:t.form,"label-width":"0"}},[e("section",[e("label",[e("span",[t._v(" JOOX Music · "),e("Ruby",{attrs:{caption:"Unique Device Identifier"}},[t._v("设备唯一识别码")])],1),e("el-form-item",{attrs:{prop:"jooxUUID"}},[e("el-input",{attrs:{type:"text",clearable:"",maxlength:"32","show-word-limit":""},model:{value:t.form.jooxUUID,callback:function(e){t.$set(t.form,"jooxUUID",e)},expression:"form.jooxUUID"}})],1)],1),e("p",{staticClass:"item-desc"},[t._v(" 下载该加密文件的 JOOX 应用所记录的设备唯一识别码。 "),e("br"),t._v(" 参见： "),e("a",{attrs:{href:"https://github.com/unlock-music/joox-crypto/wiki/%E8%8E%B7%E5%8F%96%E8%AE%BE%E5%A4%87-UUID"}},[t._v(" 获取设备 UUID · unlock-music/joox-crypto Wiki")]),t._v("。 ")])])]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",loading:t.saving},on:{click:function(e){return t.emitConfirm()}}},[t._v("确 定")])],1)],1)},[],!1,null,"58e4a4a6",null);t.a=r.exports},"73ec":function(e,t,r){"use strict";r.d(t,"e",function(){return n}),r.d(t,"d",function(){return i}),r.d(t,"b",function(){return a}),r.d(t,"c",function(){return s}),r.d(t,"f",function(){return u}),r.d(t,"a",function(){return l}),r("99af"),r("d3b7"),r("3ca3"),r("ddb0"),r("2b3d"),r("9861"),r("2ca0");var n,c=r("9ab4"),i=((t=n=n||{})[t.ArtistAndTitle=0]="ArtistAndTitle",t[t.TitleOnly=1]="TitleOnly",t[t.TitleAndArtist=2]="TitleAndArtist",t[t.SameAsOriginal=3]="SameAsOriginal",[{key:n.ArtistAndTitle,text:"歌手-歌曲名"},{key:n.TitleOnly,text:"歌曲名"},{key:n.TitleAndArtist,text:"歌曲名-歌手"},{key:n.SameAsOriginal,text:"同源文件名"}]);function o(e,t){switch(t){case n.TitleOnly:return"".concat(e.title,".").concat(e.ext);case n.TitleAndArtist:return"".concat(e.title," - ").concat(e.artist,".").concat(e.ext);case n.SameAsOriginal:return"".concat(e.rawFilename,".").concat(e.ext);default:case n.ArtistAndTitle:return"".concat(e.artist," - ").concat(e.title,".").concat(e.ext)}}function a(n,i,a){return Object(c.a)(this,void 0,void 0,function(){var t,r;return Object(c.c)(this,function(e){switch(e.label){case 0:t=o(n,i),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,a.getFileHandle(t)];case 2:return e.sent(),t="".concat((new Date).getTime()," - ").concat(t),[3,4];case 3:return e.sent(),[3,4];case 4:return[4,a.getFileHandle(t,{create:!0})];case 5:return[4,e.sent().createWritable()];case 6:return[4,(r=e.sent()).write(n.blob)];case 7:return e.sent(),[4,r.close()];case 8:return e.sent(),[2]}})})}function s(e,t){var r=document.createElement("a");r.href=e.file,r.download=o(e,t),document.body.append(r),r.click(),r.remove()}function u(e){var t;URL.revokeObjectURL(e.file),null!=(t=e.picture)&&t.startsWith("blob:")&&URL.revokeObjectURL(e.picture)}f.prototype.queue=function(e){this.pending.push(e),this.consume()},f.prototype.consume=function(){var e=this,t=this.pending.shift();t&&t().then(function(){return e.consume}).catch(console.error)};var l=f;function f(){this.pending=[]}},"77b3":function(e,t,r){"use strict";var n={name:"Ruby",props:{caption:{type:String,required:!0}}},r=r("2877"),r=Object(r.a)(n,function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("ruby",{attrs:{title:e.caption}},[e._t("default"),t("rp",[e._v("（")]),t("rt",{domProps:{textContent:e._s(e.caption)}}),t("rp",[e._v("）")])],2)},[],!1,null,null,null);t.a=r.exports},"8c80":function(e,t,r){},9224:function(e){e.exports=JSON.parse('{"name":"unlock-music","version":"1.10.5","ext_build":0,"updateInfo":"完善音乐标签编辑功能，支持编辑更多标签","license":"MIT","description":"Unlock encrypted music file in browser.","repository":{"type":"git","url":"https://github.com/ix64/unlock-music"},"private":true,"scripts":{"postinstall":"patch-package","serve":"vue-cli-service serve","build":"vue-cli-service build","test":"jest","pretty":"prettier --write src/{**/*,*}.{js,ts,jsx,tsx,vue}","pretty:check":"prettier --check src/{**/*,*}.{js,ts,jsx,tsx,vue}","make-extension":"node ./make-extension.js"},"dependencies":{"@babel/preset-typescript":"^7.16.5","@unlock-music/joox-crypto":"^0.0.1-R5","@xhacker/kgmwasm":"^1.0.0","@xhacker/qmcwasm":"^1.0.0","base64-js":"^1.5.1","browser-id3-writer":"^4.4.0","core-js":"^3.16.0","crypto-js":"^4.1.1","element-ui":"^2.15.5","iconv-lite":"^0.6.3","jimp":"^0.16.1","metaflac-js":"^1.0.5","music-metadata":"7.9.0","music-metadata-browser":"2.2.7","register-service-worker":"^1.7.2","threads":"^1.6.5","vue":"^2.6.14"},"devDependencies":{"@types/crypto-js":"^4.0.2","@types/jest":"^27.0.3","@vue/cli-plugin-babel":"^4.5.13","@vue/cli-plugin-pwa":"^4.5.13","@vue/cli-plugin-typescript":"^4.5.13","@vue/cli-service":"^4.5.13","babel-plugin-component":"^1.1.1","jest":"^27.4.5","patch-package":"^6.4.7","prettier":"2.5.1","sass":"^1.38.1","sass-loader":"^10.2.0","semver":"^7.3.5","threads-plugin":"^1.4.0","typescript":"^4.5.4","vue-cli-plugin-element":"^1.0.1","vue-template-compiler":"^2.6.14"}}')},"97e5":function(e,t,r){"use strict";r.d(t,"a",function(){return n}),r.d(t,"c",function(){return i}),r.d(t,"d",function(){return a}),r.d(t,"b",function(){return s}),r("d3b7"),r("e9c4"),r("3ca3"),r("ddb0"),r("9861"),r("99af"),r("25f0");var c=r("9ab4"),o="https://um-api.ixarea.com";function n(t){return Object(c.a)(this,void 0,Promise,function(){return Object(c.c)(this,function(e){switch(e.label){case 0:return[4,fetch(o+"/music/app-version",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Version:t})})];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}})})}function i(n,i,a){return Object(c.a)(this,void 0,Promise,function(){var t,r;return Object(c.c)(this,function(e){switch(e.label){case 0:return t=o+"/music/qq-cover",r=new URLSearchParams([["Title",n],["Artist",null!=i?i:""],["Album",null!=a?a:""]]),[4,fetch("".concat(t,"?").concat(r.toString()))];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}})})}function a(r){return Object(c.a)(this,void 0,Promise,function(){var t;return Object(c.c)(this,function(e){switch(e.label){case 0:return t="".concat(o,"/meta/qq-music-raw/").concat(r),[4,fetch(t).then(function(e){return e.json()})];case 1:if(0===(t=e.sent()).code&&0===t.req_1.code)return[2,t.req_1.data];throw new Error("请求信息失败")}})})}function s(e,t){return void 0===t&&(t=1),"".concat(o,"/music/qq-cover/").concat(t,"/").concat(e)}},"9b2d":function(e,r,n){"use strict";!function(b){n.d(r,"a",function(){return t}),n("d3b7"),n("ace4"),n("5cc6"),n("907a"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("fb6a"),n("caad"),n("25f0");var e=n("9ab4"),p=n("0ba7"),h=n("cc74"),v=32;function g(e){return 32<=e&&e<=126}function w(e){return 48<=e&&e<=57||65<=e&&e<=70}function y(e,t){for(var r=0;r<e.byteLength;r++)e[r]-=t[r%v];return b.from(e)}function t(d,m){return Object(e.a)(this,void 0,Promise,function(){var t,r,n,i,a,c,o,s,u,l,f;return Object(e.c)(this,function(e){switch(e.label){case 0:return r=Uint8Array.bind,[4,Object(h.c)(d)];case 1:for(t=new(r.apply(Uint8Array,[void 0,e.sent()])),n=t.slice(0,256),i=b.from("RIFF","ascii"),a=b.from("WAVEfmt ","ascii"),c=[],o=v;o<20*v;o+=v)(s=t.slice(o,o+v)).every(w)&&((u=y(n,s)).slice(0,4).compare(i)||u.slice(8,16).compare(a)||(l=u.readUInt32LE(16),[16,18,40].includes(l)&&(l=20+l,u.slice(l,l+4).every(g))&&((l=l+8+u.readUInt32LE(l+4))<=n.byteLength&&!u.slice(l,l+4).every(g)||c.push(b.from(s).toString("ascii")))));if(c.length<=0)throw new Error("ERROR: no suitable key discovered");return f=b.from(c[0],"ascii"),y(t,f),f=new Blob([t],{type:"audio/x-wav"}),[4,Object(p.a)(f,m,"wav",!1)];case 2:return[2,e.sent()]}})})}}.call(this,n("1c35").Buffer)},"9c0c":function(e,t,r){},ab8f:function(e,t,r){"use strict";var n=r("0565").a,r=r("2877"),r=Object(r.a)(n,function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("el-upload",{attrs:{"auto-upload":!1,"on-change":e.addFile,"show-file-list":!1,action:"",drag:"",multiple:""}},[t("i",{staticClass:"el-icon-upload"}),t("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或 "),t("em",[e._v("点击选择")])]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t("div",[e._v(" 仅在浏览器内对文件进行解锁，无需消耗流量 "),t("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v("算法在源代码中已经提供，所有运算都发生在本地")]),t("i",{staticClass:"el-icon-info",staticStyle:{"font-size":"12px"}})])],1),t("div",[e._v(" 工作模式: "+e._s(e.parallel?"多线程 Worker":"单线程 Queue")+" "),t("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[t("div",{attrs:{slot:"content"},slot:"content"},[e._v(" 将此工具部署在HTTPS环境下，可以启用Web Worker特性，"),t("br"),e._v(" 从而更快的利用并行处理完成解锁 ")]),t("i",{staticClass:"el-icon-info",staticStyle:{"font-size":"12px"}})])],1)]),t("transition",{attrs:{name:"el-fade-in"}},[t("el-progress",{directives:[{name:"show",rawName:"v-show",value:e.progress_show,expression:"progress_show"}],staticStyle:{margin:"16px 6px 0 6px"},attrs:{format:e.progress_string,percentage:e.progress_value,"stroke-width":16,"text-inside":!0}})],1)],1)},[],!1,null,null,null);t.a=r.exports},af85:function(e,t,r){"use strict";r("a9e3"),r("a434");var n=r("73ec"),i={name:"PreviewTable",props:{tableData:{type:Array,required:!0},policy:{type:Number,required:!0}},methods:{handlePlay:function(e,t){this.$emit("play",t.file)},handleDelete:function(e,t){Object(n.f)(t),this.tableData.splice(e,1)},handleDownload:function(e){this.$emit("download",e)},handleEdit:function(e){this.$emit("edit",e)}}},r=r("2877"),r=Object(r.a)(i,function(){var r=this,e=r.$createElement,n=r._self._c||e;return n("el-table",{staticStyle:{width:"100%"},attrs:{data:r.tableData}},[n("el-table-column",{attrs:{label:"封面"},scopedSlots:r._u([{key:"default",fn:function(e){return[n("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:e.row.picture}},[n("div",{staticClass:"image-slot el-image__error",attrs:{slot:"error"},slot:"error"},[r._v("暂无封面")])])]}}])}),n("el-table-column",{attrs:{label:"歌曲"},scopedSlots:r._u([{key:"default",fn:function(e){return[n("span",[r._v(r._s(e.row.title))])]}}])}),n("el-table-column",{attrs:{label:"歌手"},scopedSlots:r._u([{key:"default",fn:function(e){return[n("p",[r._v(r._s(e.row.artist))])]}}])}),n("el-table-column",{attrs:{label:"专辑"},scopedSlots:r._u([{key:"default",fn:function(e){return[n("p",[r._v(r._s(e.row.album))])]}}])}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:r._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{circle:"",icon:"el-icon-video-play",type:"success"},on:{click:function(e){return r.handlePlay(t.$index,t.row)}}}),n("el-button",{attrs:{circle:"",icon:"el-icon-download"},on:{click:function(e){return r.handleDownload(t.row)}}}),n("el-button",{attrs:{circle:"",icon:"el-icon-edit"},on:{click:function(e){return r.handleEdit(t.row)}}}),n("el-button",{attrs:{circle:"",icon:"el-icon-delete",type:"danger"},on:{click:function(e){return r.handleDelete(t.$index,t.row)}}})]}}])})],1)},[],!1,null,"7ee4db14",null);t.a=r.exports},b025:function(e,t,r){},b0a8:function(e,t,r){"use strict";r("b025")},b7c7:function(e,t,r){"use strict";r.d(t,"a",function(){return l}),r("d3b7"),r("e9c4"),r("4fad"),r("2ca0");var o=r("9ab4"),s=r("675e");i=s.b,Object(o.b)(u,i),Object.defineProperty(u,"works",{get:function(){return"undefined"!=typeof localStorage&&localStorage.getItem},enumerable:!1,configurable:!0}),u.prototype.load=function(r,n){return Object(o.a)(this,void 0,Promise,function(){var t;return Object(o.c)(this,function(e){if(null===(t=localStorage.getItem(r)))return[2,n];try{return[2,JSON.parse(t)]}catch(e){return[2,n]}return[2]})})},u.prototype.save=function(t,r){return Object(o.a)(this,void 0,Promise,function(){return Object(o.c)(this,function(e){return localStorage.setItem(t,JSON.stringify(r)),[2]})})},u.prototype.getAll=function(){return Object(o.a)(this,void 0,Promise,function(){var t,r,n,i,a,c;return Object(o.c)(this,function(e){for(t={},r=0,n=Object.entries(localStorage);r<n.length;r++)if(a=n[r],i=a[0],a=a[1],i.startsWith(s.a))try{Object.assign(t,((c={})[i]=JSON.parse(a),c))}catch(e){}return[2,t]})})},u.prototype.setAll=function(a){return Object(o.a)(this,void 0,Promise,function(){var t,r,n,i;return Object(o.c)(this,function(e){switch(e.label){case 0:t=0,r=Object.entries(a),e.label=1;case 1:return t<r.length?(i=r[t],n=i[0],i=i[1],[4,this.save(n,i)]):[3,4];case 2:e.sent(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})};t=u;n=s.b,Object(o.b)(c,n),Object.defineProperty(c,"works",{get:function(){var e;return"undefined"!=typeof chrome&&Boolean(null==(e=null==(e=null===chrome||void 0===chrome?void 0:chrome.storage)?void 0:e.local)?void 0:e.set)},enumerable:!1,configurable:!0}),c.prototype.load=function(r,n){return Object(o.a)(this,void 0,Promise,function(){return Object(o.c)(this,function(e){return[2,new Promise(function(t){var e;chrome.storage.local.get(((e={})[r]=n,e),function(e){Object.prototype.hasOwnProperty.call(e,r)?t(e[r]):t(n)})})]})})},c.prototype.save=function(r,n){return Object(o.a)(this,void 0,Promise,function(){return Object(o.c)(this,function(e){return[2,new Promise(function(e){var t;chrome.storage.local.set(((t={})[r]=n,t),e)})]})})},c.prototype.getAll=function(){return Object(o.a)(this,void 0,Promise,function(){return Object(o.c)(this,function(e){return[2,new Promise(function(c){chrome.storage.local.get(null,function(e){for(var t={},r=0,n=Object.entries(e);r<n.length;r++){var i=n[r],a=i[0],i=i[1];a.startsWith(s.a)&&(t[a]=i)}c(t)})})]})})},c.prototype.setAll=function(t){return Object(o.a)(this,void 0,Promise,function(){return Object(o.c)(this,function(e){return[2,new Promise(function(e){chrome.storage.local.set(t,e)})]})})};var n,i,a=c,r=r("efc0");function c(){return null!==n&&n.apply(this,arguments)||this}function u(){return null!==i&&i.apply(this,arguments)||this}var l=new(a.works?a:t.works?t:r.a)},cc74:function(e,A,U){"use strict";!function(i){U.d(A,"m",function(){return o}),U.d(A,"a",function(){return b}),U.d(A,"b",function(){return p}),U.d(A,"i",function(){return h}),U.d(A,"c",function(){return v}),U.d(A,"d",function(){return g}),U.d(A,"f",function(){return w}),U.d(A,"e",function(){return y}),U.d(A,"l",function(){return j}),U.d(A,"k",function(){return O}),U.d(A,"h",function(){return x}),U.d(A,"g",function(){return _}),U.d(A,"j",function(){return k}),U("d3b7"),U("fb6a"),U("3ca3"),U("ddb0"),U("2b3d"),U("9861"),U("ac1f"),U("1276"),U("498a"),U("2ca0"),U("159b");var e=U("9ab4"),t=U("7907"),a=U.n(t),t=U("b686"),c=U.n(t),o=/[ ]?[,;/_、][ ]?/,r=[102,76,97,67],n=[73,68,51],s=[79,103,103,83],u=[102,116,121,112],l=[48,38,178,117,142,102,207,17,166,217,0,170,0,98,206,108],f=[82,73,70,70],d=[255,241],m=[70,82,77,56],b={mp3:"audio/mpeg",flac:"audio/flac",m4a:"audio/mp4",ogg:"audio/ogg",wma:"audio/x-ms-wma",wav:"audio/x-wav",dff:"audio/x-dff"};function p(r,e){return!(e.length>r.length)&&e.every(function(e,t){return e===r[t]})}function h(e,t){return void 0===t&&(t="mp3"),p(e,n)?"mp3":p(e,r)?"flac":p(e,s)?"ogg":e.length>=4+u.length&&p(e.slice(4),u)?"m4a":p(e,f)?"wav":p(e,l)?"wma":p(e,d)?"aac":p(e,m)?"dff":t}function v(n){return n.arrayBuffer?n.arrayBuffer():new Promise(function(t,r){var e=new FileReader;e.onload=function(e){e=null==(e=e.target)?void 0:e.result;e?t(e):r("read file failed")},e.readAsArrayBuffer(n)})}function g(e){var t;return null!=(t=e.common)&&t.picture&&0<e.common.picture.length?URL.createObjectURL(new Blob([e.common.picture[0].data],{type:e.common.picture[0].format})):""}function w(e,t,r,n){t={title:null!=t?t:"",artist:r},r=e.split(n=void 0===n?"-":n);return 1<r.length?((!t.artist||t.artist.split(o).length<r[0].trim().split(o).length)&&(t.artist=r[0].trim()),t.title||(t.title=r[1].trim())):1!==r.length||t.title||(t.title=r[0].trim()),t}function y(i){return Object(e.a)(this,void 0,Promise,function(){var t,r,n;return Object(e.c)(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),[4,fetch(i)];case 1:return r=e.sent(),null!=(t=r.headers.get("Content-Type"))&&t.startsWith("image/")?[4,r.arrayBuffer()]:[3,3];case 2:return r=e.sent(),n=URL.createObjectURL(new Blob([r],{type:t})),[2,{buffer:r,url:n,mime:t}];case 3:return[3,5];case 4:return n=e.sent(),console.warn(n),[3,5];case 5:return[2]}})})}function j(e,t,r){var n=new a.a(e),e=((r.native["ID3v2.4"]||r.native["ID3v2.3"]||r.native["ID3v2.2"]||[]).forEach(function(t){if("TPE1"!==t.id&&"TIT2"!==t.id&&"TALB"!==t.id)try{n.setFrame(t.id,t.value)}catch(e){console.warn("failed to write ID3 tag '".concat(t.id,"'"))}}),r.common);return n.setFrame("TPE1",(null==e?void 0:e.artists)||t.artists||[]).setFrame("TIT2",(null==e?void 0:e.title)||t.title).setFrame("TALB",(null==e?void 0:e.album)||t.album||""),t.picture&&n.setFrame("APIC",{type:3,data:t.picture,description:t.picture_desc||""}),n.addTag()}function O(e,t,r){var n=new c.a(e),e=r.common;return e.title||e.album||!e.artists||(n.setTag("TITLE="+t.title),n.setTag("ALBUM="+t.album),t.artists&&(n.removeTag("ARTIST"),t.artists.forEach(function(e){return n.setTag("ARTIST="+e)}))),t.picture&&n.importPictureFromBuffer(i.from(t.picture)),n.save()}function x(e,t,r){var n=new a.a(e),e=((r.native["ID3v2.4"]||r.native["ID3v2.3"]||r.native["ID3v2.2"]||[]).forEach(function(t){if("TPE1"!==t.id&&"TIT2"!==t.id&&"TALB"!==t.id&&"TPE2"!==t.id&&"TCON"!==t.id)try{n.setFrame(t.id,t.value)}catch(e){throw new Error("failed to write ID3 tag '".concat(t.id,"'"))}}),r.common);return n.setFrame("TPE1",(null==t?void 0:t.artists)||e.artists||[]).setFrame("TIT2",(null==t?void 0:t.title)||e.title).setFrame("TALB",(null==t?void 0:t.album)||e.album||"").setFrame("TPE2",(null==t?void 0:t.albumartist)||e.albumartist||"").setFrame("TCON",(null==t?void 0:t.genre)||e.genre||[]),t.picture&&n.setFrame("APIC",{type:3,data:t.picture,description:t.picture_desc||""}),n.addTag()}function _(e,t,r){var n=new c.a(e),e=r.common;return t.title&&(e.title&&n.removeTag("TITLE"),n.setTag("TITLE="+t.title)),t.album&&(e.album&&n.removeTag("ALBUM"),n.setTag("ALBUM="+t.album)),t.albumartist&&(e.albumartist&&n.removeTag("ALBUMARTIST"),n.setTag("ALBUMARTIST="+t.albumartist)),t.artists&&(e.artists&&n.removeTag("ARTIST"),t.artists.forEach(function(e){return n.setTag("ARTIST="+e)})),t.genre&&(e.genre&&n.removeTag("GENRE"),t.genre.forEach(function(e){return n.setTag("GENRE="+e)})),t.picture&&n.importPictureFromBuffer(i.from(t.picture)),n.save()}function k(e){var t=e.lastIndexOf(".");return{ext:e.substring(t+1).toLowerCase(),name:e.substring(0,t)}}}.call(this,U("1c35").Buffer)},cd49:function(e,t,r){"use strict";r.r(t),r("9e1f"),r("450d");var t=r("6ed5"),t=r.n(t),n=(r("46a1"),r("e5f2")),n=r.n(n),i=(r("6b30"),r("c284")),i=r.n(i),a=(r("0c67"),r("299c")),a=r.n(a),c=(r("b5d8"),r("f494")),c=r.n(c),o=(r("560b"),r("dcdc")),o=r.n(o),s=(r("f225"),r("89a9")),s=r.n(s),u=(r("f4f9"),r("c2cc")),u=r.n(u),l=(r("7a0f"),r("0f6c")),l=r.n(l),f=(r("aaa5"),r("a578")),f=r.n(f),d=(r("adec"),r("3d2d")),d=r.n(d),m=(r("bdc7"),r("aa2f")),m=r.n(m),b=(r("de31"),r("c69e")),b=r.n(b),p=(r("5466"),r("ecdf")),p=r.n(p),h=(r("38a0"),r("ad41")),h=r.n(h),v=(r("10cb"),r("f3ad")),v=r.n(v),g=(r("eca7"),r("3787")),g=r.n(g),w=(r("425f"),r("4105")),w=r.n(w),y=(r("a7cc"),r("df33")),y=r.n(y),j=(r("1951"),r("eedf")),j=r.n(j),O=(r("acb6"),r("c673")),O=r.n(O),x=(r("fd71"),r("a447")),x=r.n(x),_=(r("e260"),r("e6cf"),r("cca6"),r("a79d"),r("2b0e")),k=r("1da1"),A=(r("96cf"),r("99af"),r("ab8f")),U=r("af85"),T=r("9224"),R=r("321b").a,P=r("2877"),R=Object(P.a)(R,function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("file-selector",{on:{error:t.showFail,success:t.showSuccess}}),r("div",{attrs:{id:"app-control"}},[r("el-row",{staticClass:"mb-3"},[r("span",[t._v("歌曲命名格式：")]),t._l(t.FilenamePolicies,function(e){return r("el-radio",{key:e.key,attrs:{label:e.key},model:{value:t.filename_policy,callback:function(e){t.filename_policy=e},expression:"filename_policy"}},[t._v(" "+t._s(e.text)+" ")])})],2),r("el-row",[r("edit-dialog",{attrs:{show:t.showEditDialog,picture:t.editing_data.picture,title:t.editing_data.title,artist:t.editing_data.artist,album:t.editing_data.album,albumartist:t.editing_data.albumartist,genre:t.editing_data.genre},on:{cancel:function(e){t.showEditDialog=!1},ok:t.handleEdit}}),r("config-dialog",{attrs:{show:t.showConfigDialog},on:{done:function(e){t.showConfigDialog=!1}}}),r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top"}},[r("div",{attrs:{slot:"content"},slot:"content"},[r("span",[t._v(" 部分解密方案需要设定解密参数。 ")])]),r("el-button",{attrs:{icon:"el-icon-s-tools",plain:""},on:{click:function(e){t.showConfigDialog=!0}}},[t._v("解密设定")])],1),r("el-button",{attrs:{icon:"el-icon-download",plain:""},on:{click:t.handleDownloadAll}},[t._v("下载全部")]),r("el-button",{attrs:{icon:"el-icon-delete",plain:"",type:"danger"},on:{click:t.handleDeleteAll}},[t._v("清除全部")]),r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[r("div",{attrs:{slot:"content"},slot:"content"},[t.instant_save?r("span",[t._v("工作模式: "+t._s(t.dir?"写入本地文件系统":"调用浏览器下载"))]):r("span",[t._v(" 当您使用此工具进行大量文件解锁的时候，建议开启此选项。"),r("br"),t._v(" 开启后，解锁结果将不会存留于浏览器中，防止内存不足。 ")])]),r("el-checkbox",{staticClass:"ml-2",attrs:{type:"success",border:""},model:{value:t.instant_save,callback:function(e){t.instant_save=e},expression:"instant_save"}},[t._v("立即保存")])],1)],1)],1),r("audio",{attrs:{autoplay:t.playing_auto,src:t.playing_url,controls:""}}),r("PreviewTable",{attrs:{policy:t.filename_policy,"table-data":t.tableData},on:{download:t.saveFile,edit:t.editFile,play:t.changePlaying}})],1)},[],!1,null,null,null).exports,E=r("97e5"),A={name:"app",components:{FileSelector:A.a,PreviewTable:U.a,Home:R},data:function(){return{version:T.version}},created:function(){var e=this;this.$nextTick(function(){return e.finishLoad()})},methods:{finishLoad:function(){var n=this;return Object(k.a)(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=document.getElementById("loader-mask"))&&t.remove(),e.prev=2,e.next=5,Object(E.a)(n.version);case 5:r=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.warn("check version info failed",e.t0);case 11:r&&(r.HttpsFound||r.Found&&"https:"!==window.location.protocol)?n.$notify.warning({title:"发现更新",message:"发现新版本 v".concat(r.Version,"<br/>更新详情：").concat(r.Detail,'<br/> <a target="_blank" href="').concat(r.URL,'">获取更新</a>'),dangerouslyUseHTMLString:!0,duration:15e3,position:"top-left"}):n.$notify.info({title:"离线使用",message:'<div>\n                        <p>我们使用 PWA 技术，无网络也能使用</p>\n                        <div class="update-info">\n                            <div class="update-title">最近更新</div>\n                            <div class="update-content"> '.concat(T.updateInfo,' </div>\n                        </div>\n                        <a target="_blank" href="https://github.com/ix64/unlock-music/wiki/使用提示">使用提示</a>\n                    </div>'),dangerouslyUseHTMLString:!0,duration:1e4,position:"top-left"});case 12:case"end":return e.stop()}},e,null,[[2,8]])}))()}}};r("5c0b");var D=Object(P.a)(A,function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("el-container",{attrs:{id:"app"}},[t("el-main",[t("Home")],1),t("el-footer",{attrs:{id:"app-footer"}},[t("el-row",[t("a",{attrs:{href:"https://github.com/ix64/unlock-music",target:"_blank"}},[e._v("音乐解锁")]),e._v("("+e._s(e.version)+") ：移除已购音乐的加密保护。 "),t("a",{attrs:{href:"https://github.com/ix64/unlock-music/wiki/使用提示",target:"_blank"}},[e._v("使用提示")])]),t("el-row",[e._v(" 目前支持 网易云音乐(ncm), QQ音乐(qmc, mflac, mgg), 酷狗音乐(kgm), 虾米音乐(xm), 酷我音乐(.kwm) "),t("a",{attrs:{href:"https://github.com/ix64/unlock-music/blob/master/README.md",target:"_blank"}},[e._v("更多")]),e._v("。 ")]),t("el-row",[t("span",[e._v("Copyright © 2019 - "+e._s((new Date).getFullYear())+" MengYX")]),e._v(" 音乐解锁使用 "),t("a",{attrs:{href:"https://github.com/ix64/unlock-music/blob/master/LICENSE",target:"_blank"}},[e._v("MIT许可协议")]),e._v(" 开放源代码 ")])],1)],1)},[],!1,null,null,null).exports,U=r("9483");"https:"===window.location.protocol&&Object(U.a)("".concat("","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available."),window.location.reload()},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}}),_.default.use(x.a),_.default.use(O.a),_.default.use(j.a),_.default.use(y.a),_.default.use(w.a),_.default.use(g.a),_.default.use(v.a),_.default.use(h.a),_.default.use(p.a),_.default.use(b.a),_.default.use(m.a),_.default.use(d.a),_.default.use(f.a),_.default.use(l.a),_.default.use(u.a),_.default.use(s.a),_.default.use(o.a),_.default.use(c.a),_.default.use(a.a),_.default.use(i.a),_.default.prototype.$notify=n.a,_.default.prototype.$confirm=t.a.confirm,_.default.config.productionTip=!1,new _.default({render:function(e){return e(D)}}).$mount("#app")},d4ec:function(e,t,r){"use strict";var n=r("1da1");r("d3b7"),r("3ca3"),r("ddb0"),r("2b3d"),r("9861"),r("96cf");var i={components:{Ruby:r("77b3").a},props:{show:{type:Boolean,required:!0},picture:{type:void 0|String,required:!0},title:{type:void 0|String,required:!0},artist:{type:void 0|String,required:!0},album:{type:void 0|String,required:!0},albumartist:{type:void 0|String,required:!0},genre:{type:void 0|String,required:!0}},data:function(){return{form:{},imgFile:{tmpblob:void 0,blob:void 0,url:void 0},editPicture:!1,editTitle:!1,editArtist:!1,editAlbum:!1,editAlbumartist:!1,editGenre:!1}},mounted:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.refreshForm();case 1:case"end":return e.stop()}},e)}))()},methods:{addFile:function(e){this.imgFile.tmpblob=e.raw},rmvFile:function(){this.imgFile.tmpblob=void 0},changeCover:function(){this.editPicture=!this.editPicture,!this.editPicture&&this.imgFile.tmpblob&&(this.imgFile.blob=this.imgFile.tmpblob,this.imgFile.url&&URL.revokeObjectURL(this.imgFile.url),this.imgFile.url=URL.createObjectURL(this.imgFile.blob))},refreshForm:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.imgFile.url&&URL.revokeObjectURL(t.imgFile.url),t.imgFile={tmpblob:void 0,blob:void 0,url:void 0},t.editPicture=!1,t.editTitle=!1,t.editArtist=!1,t.editAlbum=!1,t.editAlbumartist=!1,t.editGenre=!1;case 8:case"end":return e.stop()}},e)}))()},cancel:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.refreshForm(),t.$emit("cancel");case 2:case"end":return e.stop()}},e)}))()},emitConfirm:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.editPicture&&t.changeCover(),t.imgFile.url&&URL.revokeObjectURL(t.imgFile.url),t.$emit("ok",{picture:t.imgFile.blob,title:t.title,artist:t.artist,album:t.album,albumartist:t.albumartist,genre:t.genre});case 3:case"end":return e.stop()}},e)}))()}}},r=(r("1708"),r("2877")),r=Object(r.a)(i,function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("el-dialog",{attrs:{title:"音乐标签编辑",visible:t.show,"custom-class":"um-edit-dialog",center:""},on:{close:function(e){return t.cancel()}}},[e("el-form",{ref:"form",attrs:{"status-icon":"",model:t.form,"label-width":"0"}},[e("section",[e("el-image",{directives:[{name:"show",rawName:"v-show",value:!t.editPicture,expression:"!editPicture"}],staticStyle:{width:"100px",height:"100px"},attrs:{src:t.imgFile.url||t.picture}},[e("div",{staticClass:"image-slot el-image__error",attrs:{slot:"error"},slot:"error"},[t._v("暂无封面")])]),e("el-upload",{directives:[{name:"show",rawName:"v-show",value:t.editPicture,expression:"editPicture"}],attrs:{"auto-upload":!1,"on-change":t.addFile,"on-remove":t.rmvFile,"show-file-list":!0,limit:1,"list-type":"picture",action:"",drag:""}},[e("i",{staticClass:"el-icon-upload"}),e("div",{staticClass:"el-upload__text"},[t._v("将新图片拖到此处，或"),e("em",[t._v("点击选择")]),e("br"),t._v("以替换自动匹配的图片")]),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v(" 新拖到此处的图片将覆盖原始图片 ")])]),e("i",{class:{"el-icon-edit":!t.editPicture,"el-icon-check":t.editPicture},on:{click:t.changeCover}}),e("br"),t._v(" 标题: "),e("span",{directives:[{name:"show",rawName:"v-show",value:!t.editTitle,expression:"!editTitle"}]},[t._v(t._s(t.title))]),e("el-input",{directives:[{name:"show",rawName:"v-show",value:t.editTitle,expression:"editTitle"}],model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),e("i",{class:{"el-icon-edit":!t.editTitle,"el-icon-check":t.editTitle},on:{click:function(e){t.editTitle=!t.editTitle}}}),e("br"),t._v(" 艺术家: "),e("span",{directives:[{name:"show",rawName:"v-show",value:!t.editArtist,expression:"!editArtist"}]},[t._v(t._s(t.artist))]),e("el-input",{directives:[{name:"show",rawName:"v-show",value:t.editArtist,expression:"editArtist"}],model:{value:t.artist,callback:function(e){t.artist=e},expression:"artist"}}),e("i",{class:{"el-icon-edit":!t.editArtist,"el-icon-check":t.editArtist},on:{click:function(e){t.editArtist=!t.editArtist}}}),e("br"),t._v(" 专辑: "),e("span",{directives:[{name:"show",rawName:"v-show",value:!t.editAlbum,expression:"!editAlbum"}]},[t._v(t._s(t.album))]),e("el-input",{directives:[{name:"show",rawName:"v-show",value:t.editAlbum,expression:"editAlbum"}],model:{value:t.album,callback:function(e){t.album=e},expression:"album"}}),e("i",{class:{"el-icon-edit":!t.editAlbum,"el-icon-check":t.editAlbum},on:{click:function(e){t.editAlbum=!t.editAlbum}}}),e("br"),t._v(" 专辑艺术家: "),e("span",{directives:[{name:"show",rawName:"v-show",value:!t.editAlbumartist,expression:"!editAlbumartist"}]},[t._v(t._s(t.albumartist))]),e("el-input",{directives:[{name:"show",rawName:"v-show",value:t.editAlbumartist,expression:"editAlbumartist"}],model:{value:t.albumartist,callback:function(e){t.albumartist=e},expression:"albumartist"}}),e("i",{class:{"el-icon-edit":!t.editAlbumartist,"el-icon-check":t.editAlbumartist},on:{click:function(e){t.editAlbumartist=!t.editAlbumartist}}}),e("br"),t._v(" 风格: "),e("span",{directives:[{name:"show",rawName:"v-show",value:!t.editGenre,expression:"!editGenre"}]},[t._v(t._s(t.genre))]),e("el-input",{directives:[{name:"show",rawName:"v-show",value:t.editGenre,expression:"editGenre"}],model:{value:t.genre,callback:function(e){t.genre=e},expression:"genre"}}),e("i",{class:{"el-icon-edit":!t.editGenre,"el-icon-check":t.editGenre},on:{click:function(e){t.editGenre=!t.editGenre}}}),e("br"),e("p",{staticClass:"item-desc"},[t._v(" 为了节省您设备的资源，请在确定前充分检查，避免反复修改。"),e("br"),t._v(" 直接关闭此对话框不会保留所作的更改。 ")])],1)]),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.emitConfirm()}}},[t._v("确 定")])],1)],1)},[],!1,null,"b553147e",null);t.a=r.exports},efc0:function(e,t,r){"use strict";r("d3b7"),r("ddb0"),r("4ec9"),r("3ca3"),r("159b"),r("4fad");var n,c=r("9ab4"),r=r("675e"),r=(n=r.b,Object(c.b)(i,n),i.prototype.load=function(t,r){return Object(c.a)(this,void 0,Promise,function(){return Object(c.c)(this,function(e){return this.values.has(t)?[2,this.values.get(t)]:[2,r]})})},i.prototype.save=function(t,r){return Object(c.a)(this,void 0,Promise,function(){return Object(c.c)(this,function(e){return this.values.set(t,r),[2]})})},i.prototype.getAll=function(){return Object(c.a)(this,void 0,Promise,function(){var n;return Object(c.c)(this,function(e){return n={},this.values.forEach(function(e,t){var r;Object.assign(n,((r={})[t]=e,r))}),[2,n]})})},i.prototype.setAll=function(a){return Object(c.a)(this,void 0,Promise,function(){var t,r,n,i;return Object(c.c)(this,function(e){for(t=0,r=Object.entries(a);t<r.length;t++)i=r[t],n=i[0],i=i[1],this.values.set(n,i);return[2]})})},i);function i(){var e=null!==n&&n.apply(this,arguments)||this;return e.values=new Map,e}t.a=r}});